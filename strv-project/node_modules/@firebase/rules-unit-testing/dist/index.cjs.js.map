{"version":3,"file":"index.cjs.js","sources":["../src/impl/url.ts","../src/impl/discovery.ts","../src/impl/test_environment.ts","../src/impl/rules.ts","../src/initialize.ts","../src/util.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HostAndPort } from '../public_types';\n\n/**\n * Return a connectable hostname, replacing wildcard 0.0.0.0 or :: with loopback\n * addresses 127.0.0.1 / ::1 correspondingly. See below for why this is needed:\n * https://github.com/firebase/firebase-tools-ui/issues/286\n *\n * This assumes emulators are running on the same device as fallbackHost (e.g.\n * hub), which should hold if both are started from the same CLI command.\n * @private\n */\nexport function fixHostname(host: string, fallbackHost?: string): string {\n  host = host.replace('[', '').replace(']', ''); // Remove IPv6 brackets\n  if (host === '0.0.0.0') {\n    host = fallbackHost || '127.0.0.1';\n  } else if (host === '::') {\n    host = fallbackHost || '::1';\n  }\n  return host;\n}\n\n/**\n * Create a URL with host, port, and path. Handles IPv6 bracketing correctly.\n * @private\n */\nexport function makeUrl(hostAndPort: HostAndPort | string, path: string): URL {\n  if (typeof hostAndPort === 'object') {\n    const { host, port } = hostAndPort;\n    if (host.includes(':')) {\n      hostAndPort = `[${host}]:${port}`;\n    } else {\n      hostAndPort = `${host}:${port}`;\n    }\n  }\n  const url = new URL(`http://${hostAndPort}/`);\n  url.pathname = path;\n  return url;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EmulatorConfig, HostAndPort } from '../public_types';\nimport nodeFetch from 'node-fetch';\nimport { makeUrl, fixHostname } from './url';\n\n/**\n * Use the Firebase Emulator hub to discover other running emulators.\n *\n * @param hub the host and port where the Emulator Hub is running\n * @private\n */\nexport async function discoverEmulators(\n  hub: HostAndPort,\n  fetch: typeof nodeFetch = nodeFetch\n): Promise<DiscoveredEmulators> {\n  const res = await fetch(makeUrl(hub, '/emulators'));\n  if (!res.ok) {\n    throw new Error(\n      `HTTP Error ${res.status} when attempting to reach Emulator Hub at ${res.url}, are you sure it is running?`\n    );\n  }\n\n  const emulators: DiscoveredEmulators = {};\n\n  const data = await res.json();\n\n  if (data.database) {\n    emulators.database = {\n      host: data.database.host,\n      port: data.database.port\n    };\n  }\n\n  if (data.firestore) {\n    emulators.firestore = {\n      host: data.firestore.host,\n      port: data.firestore.port\n    };\n  }\n\n  if (data.storage) {\n    emulators.storage = {\n      host: data.storage.host,\n      port: data.storage.port\n    };\n  }\n\n  if (data.hub) {\n    emulators.hub = {\n      host: data.hub.host,\n      port: data.hub.port\n    };\n  }\n  return emulators;\n}\n\n/**\n * @private\n */\nexport interface DiscoveredEmulators {\n  database?: HostAndPort;\n  firestore?: HostAndPort;\n  storage?: HostAndPort;\n  hub?: HostAndPort;\n}\n\n/**\n * @private\n */\nexport function getEmulatorHostAndPort(\n  emulator: keyof DiscoveredEmulators,\n  conf?: EmulatorConfig,\n  discovered?: DiscoveredEmulators\n) {\n  if (conf && ('host' in conf || 'port' in conf)) {\n    const { host, port } = conf;\n    if (host || port) {\n      if (!host || !port) {\n        throw new Error(\n          `Invalid configuration ${emulator}.host=${host} and ${emulator}.port=${port}. ` +\n            'If either parameter is supplied, both must be defined.'\n        );\n      }\n      if (discovered && !discovered[emulator]) {\n        console.warn(\n          `Warning: config for the ${emulator} emulator is specified, but the Emulator hub ` +\n            'reports it as not running. This may lead to errors such as connection refused.'\n        );\n      }\n      return {\n        host: fixHostname(conf.host, discovered?.hub?.host),\n        port: conf.port\n      };\n    }\n  }\n  const envVar = EMULATOR_HOST_ENV_VARS[emulator];\n  const fallback = discovered?.[emulator] || emulatorFromEnvVar(envVar);\n  if (fallback) {\n    if (discovered && !discovered[emulator]) {\n      console.warn(\n        `Warning: the environment variable ${envVar} is set, but the Emulator hub reports the ` +\n          `${emulator} emulator as not running. This may lead to errors such as connection refused.`\n      );\n    }\n    return {\n      host: fixHostname(fallback.host, discovered?.hub?.host),\n      port: fallback.port\n    };\n  }\n}\n\n// Visible for testing.\nexport const EMULATOR_HOST_ENV_VARS = {\n  'database': 'FIREBASE_DATABASE_EMULATOR_HOST',\n  'firestore': 'FIRESTORE_EMULATOR_HOST',\n  'hub': 'FIREBASE_EMULATOR_HUB',\n  'storage': 'FIREBASE_STORAGE_EMULATOR_HOST'\n};\n\nfunction emulatorFromEnvVar(envVar: string): HostAndPort | undefined {\n  const hostAndPort = process.env[envVar];\n  if (!hostAndPort) {\n    return undefined;\n  }\n\n  let parsed: URL;\n  try {\n    parsed = new URL(`http://${hostAndPort}`);\n  } catch {\n    throw new Error(\n      `Invalid format in environment variable ${envVar}=${hostAndPort} (expected host:port)`\n    );\n  }\n  let host = parsed.hostname;\n  const port = Number(parsed.port || '80');\n  if (!Number.isInteger(port)) {\n    throw new Error(\n      `Invalid port in environment variable ${envVar}=${hostAndPort}`\n    );\n  }\n  return { host, port };\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fetch from 'node-fetch';\nimport firebase from 'firebase/compat/app';\nimport 'firebase/compat/firestore';\nimport 'firebase/compat/database';\nimport 'firebase/compat/storage';\n\nimport {\n  HostAndPort,\n  RulesTestContext,\n  RulesTestEnvironment,\n  TokenOptions\n} from '../public_types';\n\nimport { DiscoveredEmulators } from './discovery';\nimport { makeUrl } from './url';\n\n/**\n * An implementation of {@code RulesTestEnvironment}. This is private to hide the constructor,\n * which should never be directly called by the developer.\n * @private\n */\nexport class RulesTestEnvironmentImpl implements RulesTestEnvironment {\n  private contexts = new Set<RulesTestContextImpl>();\n  private destroyed = false;\n\n  constructor(\n    readonly projectId: string,\n    readonly emulators: DiscoveredEmulators\n  ) {}\n\n  authenticatedContext(\n    user_id: string,\n    tokenOptions?: TokenOptions\n  ): RulesTestContext {\n    this.checkNotDestroyed();\n    return this.createContext({\n      ...tokenOptions,\n      sub: user_id,\n      user_id: user_id\n    });\n  }\n\n  unauthenticatedContext(): RulesTestContext {\n    this.checkNotDestroyed();\n    return this.createContext(/* authToken = */ undefined);\n  }\n\n  async withSecurityRulesDisabled(\n    callback: (context: RulesTestContext) => Promise<void>\n  ): Promise<void> {\n    this.checkNotDestroyed();\n    // The \"owner\" token is recognized by the emulators as a special value that bypasses Security\n    // Rules. This should only ever be used in withSecurityRulesDisabled.\n    // If you're reading this and thinking about doing this in your own app / tests / scripts, think\n    // twice. Instead, just use withSecurityRulesDisabled for unit testing OR connect your Firebase\n    // Admin SDKs to the emulators for integration testing via environment variables.\n    // See: https://firebase.google.com/docs/emulator-suite/connect_firestore#admin_sdks\n    const context = this.createContext('owner');\n    try {\n      await callback(context);\n    } finally {\n      // We eagarly clean up this context to actively prevent misuse outside of the callback, e.g.\n      // storing the context in a variable.\n      context.cleanup();\n      this.contexts.delete(context);\n    }\n  }\n\n  private createContext(\n    authToken: string | firebase.EmulatorMockTokenOptions | undefined\n  ): RulesTestContextImpl {\n    const context = new RulesTestContextImpl(\n      this.projectId,\n      this.emulators,\n      authToken\n    );\n    this.contexts.add(context);\n    return context;\n  }\n\n  clearDatabase(): Promise<void> {\n    this.checkNotDestroyed();\n    return this.withSecurityRulesDisabled(context => {\n      return context.database().ref('/').set(null);\n    });\n  }\n\n  async clearFirestore(): Promise<void> {\n    this.checkNotDestroyed();\n    assertEmulatorRunning(this.emulators, 'firestore');\n\n    const resp = await fetch(\n      makeUrl(\n        this.emulators.firestore,\n        `/emulator/v1/projects/${this.projectId}/databases/(default)/documents`\n      ),\n      {\n        method: 'DELETE'\n      }\n    );\n\n    if (!resp.ok) {\n      throw new Error(await resp.text());\n    }\n  }\n\n  clearStorage(): Promise<void> {\n    this.checkNotDestroyed();\n    return this.withSecurityRulesDisabled(async context => {\n      const { items } = await context.storage().ref().listAll();\n      await Promise.all(\n        items.map(item => {\n          return item.delete();\n        })\n      );\n    });\n  }\n\n  async cleanup(): Promise<void> {\n    this.destroyed = true;\n    this.contexts.forEach(context => {\n      context.envDestroyed = true;\n      context.cleanup();\n    });\n    this.contexts.clear();\n  }\n\n  private checkNotDestroyed() {\n    if (this.destroyed) {\n      throw new Error(\n        'This RulesTestEnvironment has already been cleaned up. ' +\n          '(This may indicate a leak or missing `await` in your test cases. If you do intend to ' +\n          'perform more tests, please call cleanup() later or create another RulesTestEnvironment.)'\n      );\n    }\n  }\n}\n/**\n * An implementation of {@code RulesTestContext}. This is private to hide the constructor,\n * which should never be directly called by the developer.\n * @private\n */\nclass RulesTestContextImpl implements RulesTestContext {\n  private app?: firebase.app.App;\n  private destroyed = false;\n  envDestroyed = false;\n\n  constructor(\n    readonly projectId: string,\n    readonly emulators: DiscoveredEmulators,\n    readonly authToken: firebase.EmulatorMockTokenOptions | string | undefined\n  ) {}\n\n  cleanup() {\n    this.destroyed = true;\n    this.app?.delete();\n\n    this.app = undefined;\n  }\n\n  firestore(\n    settings?: firebase.firestore.Settings\n  ): firebase.firestore.Firestore {\n    assertEmulatorRunning(this.emulators, 'firestore');\n    const firestore = this.getApp().firestore();\n    if (settings) {\n      firestore.settings(settings);\n    }\n    firestore.useEmulator(\n      this.emulators.firestore.host,\n      this.emulators.firestore.port,\n      { mockUserToken: this.authToken }\n    );\n    return firestore;\n  }\n  database(databaseURL?: string): firebase.database.Database {\n    assertEmulatorRunning(this.emulators, 'database');\n    const database = this.getApp().database(databaseURL);\n    database.useEmulator(\n      this.emulators.database.host,\n      this.emulators.database.port,\n      { mockUserToken: this.authToken }\n    );\n    return database;\n  }\n  storage(bucketUrl = `gs://${this.projectId}`): firebase.storage.Storage {\n    assertEmulatorRunning(this.emulators, 'storage');\n    const storage = this.getApp().storage(bucketUrl);\n    storage.useEmulator(\n      this.emulators.storage.host,\n      this.emulators.storage.port,\n      { mockUserToken: this.authToken }\n    );\n    return storage;\n  }\n\n  private getApp(): firebase.app.App {\n    if (this.envDestroyed) {\n      throw new Error(\n        'This RulesTestContext is no longer valid because its RulesTestEnvironment has been ' +\n          'cleaned up. (This may indicate a leak or missing `await` in your test cases.)'\n      );\n    }\n    if (this.destroyed) {\n      throw new Error(\n        'This RulesTestContext is no longer valid. When using withSecurityRulesDisabled, ' +\n          'make sure to perform all operations on the context within the callback function and ' +\n          'return a Promise that resolves when the operations are done.'\n      );\n    }\n    if (!this.app) {\n      this.app = firebase.initializeApp(\n        { projectId: this.projectId },\n        `_Firebase_RulesUnitTesting_${Date.now()}_${Math.random()}`\n      );\n    }\n    return this.app;\n  }\n}\n\nexport function assertEmulatorRunning<E extends keyof DiscoveredEmulators>(\n  emulators: DiscoveredEmulators,\n  emulator: E\n): asserts emulators is Record<E, HostAndPort> {\n  if (!emulators[emulator]) {\n    if (emulators.hub) {\n      throw new Error(\n        `The ${emulator} emulator is not running (according to Emulator hub). To force ` +\n          'connecting anyway, please specify its host and port in initializeTestEnvironment({...}).'\n      );\n    } else {\n      throw new Error(\n        `The host and port of the ${emulator} emulator must be specified. (You may wrap the test ` +\n          \"script with `firebase emulators:exec './your-test-script'` to enable automatic \" +\n          `discovery, or specify manually via initializeTestEnvironment({${emulator}: {host, port}}).`\n      );\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { HostAndPort } from '../public_types';\nimport { makeUrl } from './url';\nimport fetch from 'node-fetch';\n\n/**\n * @private\n */\nexport async function loadDatabaseRules(\n  hostAndPort: HostAndPort,\n  databaseName: string,\n  rules: string\n): Promise<void> {\n  const url = makeUrl(hostAndPort, '/.settings/rules.json');\n  url.searchParams.append('ns', databaseName);\n  const resp = await fetch(url, {\n    method: 'PUT',\n    headers: { Authorization: 'Bearer owner' },\n    body: rules\n  });\n\n  if (!resp.ok) {\n    throw new Error(await resp.text());\n  }\n}\n\n/**\n * @private\n */\nexport async function loadFirestoreRules(\n  hostAndPort: HostAndPort,\n  projectId: string,\n  rules: string\n): Promise<void> {\n  const resp = await fetch(\n    makeUrl(hostAndPort, `/emulator/v1/projects/${projectId}:securityRules`),\n    {\n      method: 'PUT',\n      body: JSON.stringify({\n        rules: {\n          files: [{ content: rules }]\n        }\n      })\n    }\n  );\n\n  if (!resp.ok) {\n    throw new Error(await resp.text());\n  }\n}\n\n/**\n * @private\n */\nexport async function loadStorageRules(\n  hostAndPort: HostAndPort,\n  rules: string\n): Promise<void> {\n  const resp = await fetch(makeUrl(hostAndPort, '/internal/setRules'), {\n    method: 'PUT',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      rules: {\n        files: [{ name: 'storage.rules', content: rules }]\n      }\n    })\n  });\n  if (!resp.ok) {\n    throw new Error(await resp.text());\n  }\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { RulesTestEnvironment, TestEnvironmentConfig } from './public_types';\nimport {\n  DiscoveredEmulators,\n  discoverEmulators,\n  getEmulatorHostAndPort\n} from './impl/discovery';\nimport {\n  assertEmulatorRunning,\n  RulesTestEnvironmentImpl\n} from './impl/test_environment';\nimport {\n  loadDatabaseRules,\n  loadFirestoreRules,\n  loadStorageRules\n} from './impl/rules';\n\n/**\n * Initializes a test environment for rules unit testing. Call this function first for test setup.\n *\n * Requires emulators to be running. This function tries to discover those emulators via environment\n * variables or through the Firebase Emulator hub if hosts and ports are unspecified. It is strongly\n * recommended to specify security rules for emulators used for testing. See minimal example below.\n *\n * @param config the configuration for emulators. most fields are optional if they can be discovered\n * @returns a promise that resolves with an environment ready for testing, or rejects on error.\n * @public\n * @example\n * ```javascript\n * const testEnv = await initializeTestEnvironment({\n *   firestore: {\n *     rules: fs.readFileSync(\"/path/to/firestore.rules\", \"utf8\"), // Load rules from file\n *     // host and port can be omitted if they can be discovered from the hub.\n *   },\n *   // ...\n * });\n * ```\n */\nexport async function initializeTestEnvironment(\n  config: TestEnvironmentConfig\n): Promise<RulesTestEnvironment> {\n  const projectId = config.projectId || process.env.GCLOUD_PROJECT;\n  if (!projectId) {\n    throw new Error(\n      'Missing projectId option or env var GCLOUD_PROJECT! Please specify the projectId either ' +\n        'way.\\n(A demo-* projectId is strongly recommended for unit tests, such as \"demo-test\".)'\n    );\n  }\n  const hub = getEmulatorHostAndPort('hub', config.hub);\n  let discovered = hub ? { ...(await discoverEmulators(hub)), hub } : undefined;\n\n  const emulators: DiscoveredEmulators = {};\n  if (hub) {\n    emulators.hub = hub;\n  }\n\n  for (const emulator of SUPPORTED_EMULATORS) {\n    const hostAndPort = getEmulatorHostAndPort(\n      emulator,\n      config[emulator],\n      discovered\n    );\n    if (hostAndPort) {\n      emulators[emulator] = hostAndPort;\n    }\n  }\n\n  if (config.database?.rules) {\n    assertEmulatorRunning(emulators, 'database');\n    await loadDatabaseRules(\n      emulators.database,\n      projectId,\n      config.database.rules\n    );\n  }\n  if (config.firestore?.rules) {\n    assertEmulatorRunning(emulators, 'firestore');\n    await loadFirestoreRules(\n      emulators.firestore,\n      projectId,\n      config.firestore.rules\n    );\n  }\n  if (config.storage?.rules) {\n    assertEmulatorRunning(emulators, 'storage');\n    await loadStorageRules(emulators.storage, config.storage.rules);\n  }\n\n  return new RulesTestEnvironmentImpl(projectId, emulators);\n}\n\nconst SUPPORTED_EMULATORS = ['database', 'firestore', 'storage'] as const;\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  EMULATOR_HOST_ENV_VARS,\n  getEmulatorHostAndPort\n} from './impl/discovery';\nimport { fixHostname, makeUrl } from './impl/url';\nimport { HostAndPort } from './public_types';\nimport fetch from 'node-fetch';\n\n/**\n * Run a setup function with background Cloud Functions triggers disabled. This can be used to\n * import data into the Realtime Database or Cloud Firestore emulator without triggering locally\n * emulated Cloud Functions.\n *\n * This method only works with Firebase CLI version 8.13.0 or higher. This overload works only if\n * the Emulator hub host:port is specified by the environment variable FIREBASE_EMULATOR_HUB.\n *\n * @param fn an function which may be sync or async (returns a promise)\n * @public\n */\nexport async function withFunctionTriggersDisabled<TResult>(\n  fn: () => TResult | Promise<TResult>\n): Promise<TResult>;\n\n/**\n * Run a setup function with background Cloud Functions triggers disabled. This can be used to\n * import data into the Realtime Database or Cloud Firestore emulator without triggering locally\n * emulated Cloud Functions.\n *\n * This method only works with Firebase CLI version 8.13.0 or higher. The Emulator hub must be\n * running, which host and port are specified in this overload.\n *\n * @param fn an function which may be sync or async (returns a promise)\n * @param hub the host and port of the Emulator Hub (ex: `{host: 'localhost', port: 4400}`)\n * @public\n */\nexport async function withFunctionTriggersDisabled<TResult>(\n  hub: { host: string; port: number },\n  fn: () => TResult | Promise<TResult>\n): Promise<TResult>;\n\nexport async function withFunctionTriggersDisabled<TResult>(\n  fnOrHub: { host: string; port: number } | (() => TResult | Promise<TResult>),\n  maybeFn?: () => TResult | Promise<TResult>\n): Promise<TResult> {\n  let hub: HostAndPort | undefined;\n  if (typeof fnOrHub === 'function') {\n    maybeFn = fnOrHub;\n    hub = getEmulatorHostAndPort('hub');\n  } else {\n    hub = getEmulatorHostAndPort('hub', fnOrHub);\n    if (!maybeFn) {\n      throw new Error('The callback function must be specified!');\n    }\n  }\n  if (!hub) {\n    throw new Error(\n      'Please specify the Emulator Hub host and port via arguments or set the environment ' +\n        `varible ${EMULATOR_HOST_ENV_VARS.hub}!`\n    );\n  }\n\n  hub.host = fixHostname(hub.host);\n  makeUrl(hub, '/functions/disableBackgroundTriggers');\n  // Disable background triggers\n  const disableRes = await fetch(\n    makeUrl(hub, '/functions/disableBackgroundTriggers'),\n    {\n      method: 'PUT'\n    }\n  );\n  if (!disableRes.ok) {\n    throw new Error(\n      `HTTP Error ${disableRes.status} when disabling functions triggers, are you using firebase-tools 8.13.0 or higher?`\n    );\n  }\n\n  // Run the user's function\n  let result: TResult | undefined = undefined;\n  try {\n    result = await maybeFn();\n  } finally {\n    // Re-enable background triggers\n    const enableRes = await fetch(\n      makeUrl(hub, '/functions/enableBackgroundTriggers'),\n      {\n        method: 'PUT'\n      }\n    );\n\n    if (!enableRes.ok) {\n      throw new Error(\n        `HTTP Error ${enableRes.status} when enabling functions triggers, are you using firebase-tools 8.13.0 or higher?`\n      );\n    }\n  }\n\n  // Return the user's function result\n  return result;\n}\n\n/**\n * Assert the promise to be rejected with a \"permission denied\" error.\n *\n * Useful to assert a certain request to be denied by Security Rules. See example below.\n * This function recognizes permission-denied errors from Database, Firestore, and Storage JS SDKs.\n *\n * @param pr the promise to be asserted\n * @returns a Promise that is fulfilled if pr is rejected with \"permission denied\". If pr is\n *          rejected with any other error or resolved, the returned promise rejects.\n * @public\n * @example\n * ```javascript\n * const unauthed = testEnv.unauthenticatedContext();\n * await assertFails(get(doc(unauthed.firestore(), '/private/doc'), { ... });\n * ```\n */\nexport function assertFails(pr: Promise<any>): Promise<any> {\n  return pr.then(\n    () => {\n      return Promise.reject(\n        new Error('Expected request to fail, but it succeeded.')\n      );\n    },\n    (err: any) => {\n      const errCode = err?.code?.toLowerCase() || '';\n      const errMessage = err?.message?.toLowerCase() || '';\n      const isPermissionDenied =\n        errCode === 'permission-denied' ||\n        errCode === 'permission_denied' ||\n        errMessage.indexOf('permission_denied') >= 0 ||\n        errMessage.indexOf('permission denied') >= 0 ||\n        // Storage permission errors contain message: (storage/unauthorized)\n        errMessage.indexOf('unauthorized') >= 0;\n\n      if (!isPermissionDenied) {\n        return Promise.reject(\n          new Error(\n            `Expected PERMISSION_DENIED but got unexpected error: ${err}`\n          )\n        );\n      }\n      return err;\n    }\n  );\n}\n\n/**\n * Assert the promise to be rejected with a \"permission denied\" error.\n *\n * This is a no-op function returning the passed promise as-is, but can be used for documentational\n * purposes in test code to emphasize that a certain request should succeed (e.g. allowed by rules).\n *\n * @public\n * @example\n * ```javascript\n * const alice = testEnv.authenticatedContext('alice');\n * await assertSucceeds(get(doc(alice.firestore(), '/doc/readable/by/alice'), { ... });\n * ```\n */\nexport function assertSucceeds<T>(pr: Promise<T>): Promise<T> {\n  return pr;\n}\n"],"names":["fetch","firebase"],"mappings":"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"}